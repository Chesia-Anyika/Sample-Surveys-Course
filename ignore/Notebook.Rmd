---
title: "Sample Surveys Notebook"
author: "Chesia Anyika"
date: "2024-02-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Libraries

```{r}
library(gtools)
library(tidyverse)
library(survey)
library(SDAResources)
```

# Chapter 1: Introduction

## Introductory Exercises

**For each survey in Exercises 1--20, describe the target population, sampling frame, sampling unit, and observation unit. Discuss any possible sources of selection bias or inaccuracy of responses.**

### Question 1

The article "What Readers Say about Marijuana" (Parade, July 31, 1994, p. 16) reported "More than 75% of the readers who took part in an informal PARADE telephone poll say marijuana should be as legal as alcoholic beverages." The telephone poll was announced on page 5 of the June 12 issue; readers were instructed to "Call 1-900-773-1200, at 75 cents a call, if you would like to answer the following questions. Use touch-tone phones only. To participate, call between 8 a.m. EDT [Eastern DaylightTime] on Saturday, June 11, and midnight EDT on Wednesday, June 15."

> **Target population:**
>
> Unclear, but presumed to be readers of Parade magazine.
>
> **Sampling frame:**
>
> Persons who know about the telephone survey.
>
> **Sampling unit** **= observation unit**:
>
> One call. (Although it would also be correct to
>
> consider the sampling unit to be a person. The survey is so badly done that it is
>
> difficult to tell what the units are.)
>
> **Bias**
>
> As noted in Section 1.3, samples that consist only of volunteers are suspect. This is
>
> especially true of surveys in which respondents must pay to participate, as here---
>
> persons willing to pay 75 cents a call are likely to have strong opinions about the
>
> legalization of marijuana, and it is impossible to say whether pro- or anti-legalization
>
> adherents are more likely to call. This survey is utterly worthless for measuring
>
> public opinion because of its call-in format. Other potential biases, such as requiring
>
> a touch-tone telephone, or the sensitive subject matter or the ambiguity of the
>
> wording (what does "as legal as alcoholic beverages" mean?) probably make little
>
> difference because the call-in structure destroys all credibility for the survey by itself

### Question 2

A student wants to estimate the percentage of mutual funds whose shares went up in price last week. She selects every tenth fund listing in the Mutual Fund pages of the newspaper, and calculates the percentage of those in which the share price increased.

> **Target population**:
>
> All mutual funds.
>
> **Sampling frame:**
>
> Mutual funds listed in newspaper.
>
> **Sampling unit = observation unit**:
>
> One listing.
>
> **Bias**:
>
> As funds are listed alphabetically by company, there is no reason to believe there
>
> will be any selection bias from the sampling frame. There may be undercoverage,
>
> however, if smaller or new funds are not listed in the newspaper

### Question 3

Amazon books (www.amazon.com) summarizes reader reviews of the books it sells. Persons who want to review a book can submit a review online; Amazon then reports the average rating from all reader reviews on its website.

> **Target population:**
>
> Not specified, but a target population of interest would be
>
> persons who have read the book.
>
> **Sampling frame:**
>
> Persons who visit the website
>
> **Sampling unit = observation unit:**
>
> One review
>
> **Bias**
>
> The reviews are contributed by volunteers. They cannot be taken as representative
>
> of readers' opinions. Indeed, there have been instances where authors of competing
>
> books have written negative reviews of a book, although amazon.com tries to curb
>
> such practices

### Question 4

Potential jurors in some jurisdictions are chosen from a list of county residents who are registered voters or licensed drivers over age 18. In the fourth quarter of 1994, 100,300 jury summons were mailed to Maricopa County, Arizona, residents. Approximately 23,000 of those were returned from the post office as undeliverable. Approximately 7000 persons were unqualified for service because they were not citizens, were under 18, were convicted felons, or other reason that disqualified them from serving on a jury. An additional 22,000 were excused from jury service because of illness, financial hardship, military service, or other acceptable reason. The final sample consists of persons who appear for jury duty; some unexcused jurors fail to appear.

> **Target population:**
>
> Persons eligible for jury duty in Maricopa County.
>
> **Sampling frame:**
>
> County residents who are registered voters or licensed drivers over 18
>
> **Sampling unit = observation unit:**
>
> One resident.
>
> **Bias**
>
> Selection bias occurs largely because of under-coverage and nonresponse. Eligible
>
> jurors may not appear in the sampling frame because they are not registered to vote
>
> and they do not possess an Arizona driver's license. Addresses on either list may not
>
> be up to date. In addition, jurors fail to appear or are excused; this is nonresponse.
>
> A similar question for class discussion is whether there was selection bias in selecting
>
> which young men in the U.S ˙were to be drafted and sent to Vietnam.

### Question 5

Many scholars and policy makers are interested in the proportion of homeless people who are mentally ill. Wright (1988) estimates that 33% of all homeless people are mentally ill, by sampling homeless persons who received medical attention from one of the clinics in the Health Care for the Homeless (HCH) project. He argues that selection bias is not a serious problem because the clinics were easily accessible to the homeless and because the demographic profiles of HCH clients were close to those of the general homeless population in each city in the sample. Do you agree?

> **Target population:**
>
> All homeless persons in study area.
>
> **Sampling frame:**
>
> Clinics participating in the Health Care for the Homeless project.
>
> **Sampling unit:**
>
> Unclear. Depending on assumptions made about the survey design, one could say either a clinic or a homeless person is the sampling unit.
>
> **Observation unit:**
>
> Person.
>
> **Bias**
>
> Selection bias may be a serious problem for this survey. Even though the demo-
>
> graphics for HCH patients are claimed to match those of the homeless population
>
> (but do we know they match?) and the clinics are readily accessible, the patients
>
> differ in two critical ways from non-patients: (1) they needed medical treatment,
>
> and (2) they went to a clinic to get medical treatment. One does not know the
>
> likely direction of selection bias, but there is no reason to believe that the same
>
> percentages of patients and non-patients are mentally ill

### Question 6

Approximately 16,500 women returned the Healthy Women Survey that appeared in the September 1992 issue of Prevention. The May 1993 issue, reporting on the survey, stated that "Ninety-two percent of our readers rated their health as excellent, very good or good."

> **Target population:** Female readers of Prevention magazine.
>
> **Sampling frame:** Women who see the survey in a copy of the magazine.
>
> **Sampling unit = observation unit:** One woman.
>
> **Bias**
>
> This is a mail-in survey of volunteers, and we cannot trust any statistics from it

### Question 7

A survey is conducted to find the average weight of cows in a region. A list of all farms is available for the region, and 50 farms are selected at random. Then the weight of each cow at the 50 selected farms is recorded.

> **Target population:**
>
> All cows in region.
>
> **Sampling frame:**
>
> List of all farms in region.
>
> **Sampling unit:**
>
> One farm.
>
> **Observation unit:**
>
> One cow.
>
> **Bias**
>
> There is no reason to anticipate selection bias in this survey. The design is a single-stage cluster sample, discussed in Chapter 5

### Question 8

To study nutrient content of menus in boarding homes for the elderly in Washington State, Goren et al. (1993) mailed surveys to all 184 licensed homes in Washington State, directed to the administrator and food service manager. Of those, 43 were returned by the deadline and included menus.

> **Target population:**
>
> Licensed boarding homes for the elderly in Washingtonstate.
>
> **Sampling frame:**
>
> List of 184 licensed homes.
>
> **Sampling unit = observation unit:**
>
> One home.
>
> **Bias**
>
> Nonresponse is the obvious problem here, with only 43 of 184 administrators or food
>
> service managers responding. It may be that the respondents are the larger homes,
>
> or that their menus have better nutrition. The problem with nonresponse, though,
>
> is that we can only conjecture the direction of the nonresponse bias

### Question 13

The American Statistical Association sent the following e-mail with subject line "Joint Statistical Meetings 2005 Participants Survey" to a sample of persons who attended the 2005 Joint Statistical Meetings: "Thank you for attending the 2005 Joint Statistical Meetings (JSM) in Minneapolis, Minnesota. We need your help to complete an online survey about the JSM. Because the quality of the JSM is very important, a survey is being conducted to find out how we might improve future meetings. We would like to get your opinion about various aspects of the 2005 meeting your preferences for 2006 and beyond. You are part of a small sample of conference registrants who have been selected randomly to participate in the survey. We hope you will take the time to complete this short questionnaire online at www.amstat.org/meetings/jsm/2005/survey. In order to tabulate and analyze the data, please submit your response by mid-September 2005."

> **Target population:**
>
> All attendees of the 2005 JSM.
>
> **Sampling population:**
>
> E-mail addresses provided by the attendees of the 2005 JSM.
>
> **Sampling unit:**
>
> One e-mail address.
>
> **Bias**
>
> It is stated that the small sample of conference registrants was selected randomly.
>
> This is good, since the ASA can control the quality better and follow up on non-
>
> respondents. It also means, since the sample is selected, that persons with strong
>
> opinions cannot flood the survey. But nonresponse is a potential problem---response
>
> is not mandatory and it might be feared that only attendees with strong opinions
>
> or a strong sense of loyalty to the ASA will respond to the survey.

### Question 14

Fark and Johnson (1997) report on a survey of professors of education taken in summer of 1997 and conclude that there is a large disparity between the views of education professors and those of the general public. A sample of 5324 education professors was drawn from a population of about 34,000 education professors in colleges and universities across the country. A letter was mailed to each professor in the sample in May 1997, inviting him or her to participate and to provide a number where he or she could be reached during the summer for a telephone interview. During the summer, a total of 778 interviews were completed by telephone. An additional 122 interviews were obtained by calling professors in the sample at work in August and September. To attempt to minimize question order effects, the survey was pretested and some questions were asked in random order. Respondents were asked which in a series of qualities were "absolutely essential" to be imparted to prospective teachers: 84% of the respondents selected having teachers who are "life-long learners and constantly updating their skills"; 41%, having teachers "trained in pragmatic issues of running a classroom such as managing time and preparing lesson plans"; 19%, for teachers to "stress correct spelling, grammar, and punctuation"; and 12%, for teachers to "expect students to be neat, on time, and polite"

> **Target population:**
>
> All professors of education
>
> **Sampling population:**
>
> List of education professors
>
> **Sampling unit:**
>
> One professor
>
> **Bias**
>
> Information about how the sample was selected was not given in the publication,
>
> but let's assume it was a random sample. Obviously, nonresponse is a huge problem
>
> with this survey. Of the 5324 professors selected to be in the sample, only 900 were
>
> interviewed. Professors who travel during summer could of course not be contacted;
>
> also, summer is the worst time of year to try to interview professors for a survey

### Question 15

Kripke et al. (2002) claim that persons who sleep 8 or more hours per night have a higher mortality risk than persons who sleep 6 or 7 hours. They analyzed data from the 1982 Cancer Prevention Study II of the American Cancer Society, a national survey taken by about 1.1 million people. The survival or date of death was determined for about 98% of the sample six years later. Most of the respondents were friends and relatives of American Cancer Society volunteers; the purpose of the original survey was to explore factors associated with the development of cancer, but the survey also contained a few questions about sleep and insomnia.

> **Target population:**
>
> All adults
>
> **Sampling population:**
>
> Friends and relatives of American Cancer Society volunteers
>
> **Sampling unit:**
>
> One person
>
> **Bias**
>
> Here's what I wrote about the survey elsewhere:
>
> "Although the sample contained Americans of diverse ages and backgrounds, and
>
> the sample may have provided valuable information for exploring factors associated
>
> with development of cancer, its validity for investigating the relationship between
>
> amount of sleep and mortality is questionable. The questions about amount of
>
> sleep and insomnia were not the focus of the original study, and the survey was not
>
> designed to obtain accurate responses to those questions. The design did not allowresearchers to assess whether the sample was representative of the target population
>
> of all Americans. Because of the shortcomings in the survey design, it is impossible
>
> to know whether the conclusions in Kripke et al. (2002) about sleep and mortality
>
> are valid or not." (pp. 97--98)
>
> Lohr, S. (2008). "Coverage and sampling," chapter 6 of International Handbook of
>
> Survey Methodology, ed. E. deLeeuw, J. Hox, D. Dillman. New York: Erlbaum,
>
> 97--112

# Chapter 3: Stratified Sampling

> **Definition**:
>
> -   In a **stratified sample**, researchers divide a **population** into homogeneous subpopulations called *strata* (the plural of *stratum)* based on specific characteristics.
>
> -   Each stratum is then sampled using another probability sampling method, allowing researchers to estimate statistical measures for each sub-population.
>
> **When to Use**
>
> -   Ensuring diversity of your sample : We want to be protected from the possibility of obtaining a really bad sample
>
> -   We may want data of known precision for subgroups of the population. These sub- groups should be the strata.
>
> -   A stratified sample may be more convenient to administer and may result in a lower cost for the survey
>
> -   Lowering overall variance in the population: Stratified sampling often gives more precise (having lower variance) estimates for population means and totals.
>
> -   Ensuring similar variance despite differences in subgroup totals within a population.

## Overall Method

1.  Define your population and subgroups (by chaaracteristics for stratification)
2.  Separate population into strata - assign every member of the population to 1 stratum
3.  Decide on the sample size for each stratum, and total sample size
4.  Randomly sample each stratum

## Introductory Exercises

### Question 2

**Consider the hypothetical population below. Consider the stratification below, with** $N_1 = N_2 = 4$**. The population is:**

| Unit Number | Stratum | y   |
|-------------|---------|-----|
| 1           | 1       | 1   |
| 2           | 1       | 2   |
| 3           | 1       | 4   |
| 8           | 1       | 8   |
| 4           | 2       | 4   |
| 5           | 2       | 7   |
| 6           | 2       | 7   |
| 7           | 2       | 7   |

Consider the stratified sampling design in which $n_1 = n_2 = 2$.

a\. Write out all possible SRSs of size 2 from stratum 1, and find the probability of each sample. Do the same for stratum 2.

```{r}
#create the table in r
unit <- c(1,2,3,8,4,5,6,7)
strata <- c(rep(1, 4), rep(2, 4))
y <- c(1,2,4,8,4,7,7,7)

df <- data.frame(unit = unit, strata = strata, y = y)
df
```

Samples for stratum 1:

```{r}
#filter for only strata 1 responses #library(tidyverse)
s1 <- df %>% 
  filter(strata == 1)


#get the samples of s=2 of strata 1 #library(gtools)
samples1 <- as.data.frame(combinations(n = 4, r = 2, v = s1$unit, repeats.allowed = FALSE))

samples1 <- samples1 %>%
  mutate(samples1 = paste(V1, V2, sep = ","))

samples1$samples1
```

Samples for stratum 2:

```{r}
#filter for only strata 2 responses #library(tidyverse)
s2 <- df %>% 
  filter(strata == 2)


#get the samples of s=2 of strata 1 #library(gtools)
samples2 <- as.data.frame(combinations(n = 4, r = 2, v = s2$unit, repeats.allowed = FALSE))

samples2 <- samples2 %>%
  mutate(samples2 = paste(V1, V2, sep = ","))

samples2$samples2
```

To get the probability distributions for the samples, I

-   got the probability of selecting a single sample of units

-   Got the average of the y values for each sample of units

-   Used the formula $\hat t_h = 4 \bar y_h$ to get the estimated total per stratum (from $T = N_i \bar y_i$ )

For stratum 1:

```{r}
nrow(samples1)
```

As there are 6 total samples of units, the probability of getting any of the 6 samples is 1/6.

```{r}
probs.vec <- c(rep(1/6, 6))
probs.vec
```

To create a vector of the average of y values associated with each sample of units ( $\hat y_h$ ), I replicated the sample i ran before on the y column, and used the `mean()` fucntion on the result

```{r}
#get the samples of s=2 of y_1 #library(gtools)
y1 <- combinations(n = 4, r = 2, v = s1$y, repeats.allowed = FALSE)


y1
```

```{r}
y.mean <- apply(y1, 1, mean)

y.mean
```

I then computed the formula $\hat t_h = 4 \bar y_h$ as follows:

```{r}
t_1 <- y.mean * 4
t_1
```

The resulting Probability Distribution for $t_1$

```{r}
dist1 <- data.frame(samples = samples1$samples1, TotalEst = t_1, Probability = probs.vec) 

dist1
```

For stratum 2: (I repeated the same procedure)

```{r}
nrow(samples2) #6, so we will use the same probabilities vector

#get the samples of s=2 of y_2 #library(gtools)
V1 <- c(rep(4, 3), rep(7, 3))
V2 <- c(rep(7, 6))

y2 <- data.frame(V1 = V1, V2 = V2)

#get the sum of the y samples
y.sum2 <- apply(y2, 1, mean)

#compute the total y estimates as  per the formula
t_2 <- y.sum2 * 4
t_2

#show the resulting probability distribution of the ytotal estimates
dist2 <- data.frame(samples = samples2$samples2, TotalEst = t_2, Probability = probs.vec) 

dist2
```

**b. Using your work in (a), find the sampling distribution of** $\hat t_{str}$**. (the total estimate)**

Excluding the samples column, the probability distributions for strata 1 and 2 are as follows:

For strata 1

```{r}
dist1 <- dist1[,-1]
dist1
```

For strata 2: (summarised)

```{r}
dist2 <- dist2[,-1]
dist2 <- dist2 %>%
  group_by(TotalEst) %>%
  summarise(Probability = sum(Probability))

dist2
```

Because we sample independently in Strata 1 and 2, we use the formula:

$$
P(\hat t_1=j \wedge \hat t_2 = k) = P(\hat t_1 = j)P(\hat t_2 = k))
$$

> Where:
>
> -   $P(\hat t_1=j \wedge \hat t_2 = k)$ is the joint probability of observing the estimated total ( $\hat t$ ) in stratum 1 ( $\hat t_1$ ) being equal to $j$ and the estimated total in stratum 2 ( $\hat t_2$) being equal to $k$
>
> -   $P(\hat t_1 = j)$ is the probability of observing the estimated total in stratum 1 being equal to $j$.
>
> -   $P(\hat t_2 = k)$ is the probability of observing the estimated total in stratum 2 being equal to $k$.

Thus, the joint probability is found by multiplying the probabilities from the stratum 1 distribution and the strata 2 distribution

```{r}
#joint probability
jp <- 1/6 * 1/2

cat('The joint probability is', jp)
```

Thus, to find the joint probability, I created a function that got all possible samples of sample size 2, with one element from the probability distribution of stratum 1, and the other from the probability distribution of stratum 2. Furthermore, I got the sum of each sample and created a dataframe as follows:

```{r}
#get samples of size 2 from both strata
vec1 <- dist1$TotalEst
vec2 <- dist2$TotalEst

# Initialize an empty list to store the samples
s.df <- data.frame(s.pair = character(), stringsAsFactors = FALSE)

# Iterate through each element in vec1
for (i1 in vec1) {
  # Iterate through each element in vec2
  for (i2 in vec2) {
    # Create a sample of size 2 with one element from vec1 and one element from vec2
    s.pair <- paste(i1, i2, sep = ",")
    
    #sum
    sum_pair <- i1 + i2
    
    # Append the sample to the list
    s.df <- rbind(s.df, data.frame(s.pair, sum_pair, stringsAsFactors = FALSE))  }
}

s.df
```

Adding the joint probabilities

```{r}
n <- nrow(s.df)
jp.vec <- rep(jp, n)

s.df$JointProb <- jp.vec

s.df

```

Thus the sampling distribution can be given by

```{r}
s.df <- s.df[,-1]

s.df <- s.df %>%
  group_by(sum_pair) %>%
  summarise(JointProb = sum(JointProb))

s.df
```

**c. Find the mean and variance of the sampling distribution of** $\hat t_{str}$**. How do these compare to the mean and variance in SRS.**

Formulas:

$$
E[\hat t_{str}] = \sum_k kP(\hat t_{str} = k) 
$$

$$
V[\hat t_{str}] = \sum_k(k- E[\hat t_{str}])^2P(\hat t_{str} = k) 
$$

I computed the first assuming the `sum_pair` is represented by k, and the `JointProb` is represented by P

```{r}
# Assuming sum_pair is the variable representing k
expected_value <- s.df %>%
  summarise(ExpectedValue = sum(sum_pair * JointProb))

expected_value
```

I computed the second formula as follows:

```{r}
# Assuming sum_pair is the variable representing k and ExpectedValue is already calculated
variance <- s.df %>%
  summarise(Variance = sum((sum_pair - expected_value$ExpectedValue)^2 * JointProb))

variance
```

### Question 3

Consider a population of 6 students. Suppose we know the test scores of the students to be

| Student   | 1   | 2   | 3   | 4   | 5   | 6   |
|-----------|-----|-----|-----|-----|-----|-----|
| **Score** | 66  | 59  | 70  | 83  | 82  | 71  |

a\. Find the mean $\bar y_U$ and variance $S^2$ of the population.

```{r}
#student and scores vectors
student <- c(1,2,3,4,5,6)
score <- c(66, 59, 70, 83, 82, 71)

mean.score <- mean(score)
var.score <- var(score)

cat('Mean:', mean.score, '\n Variance: ', var.score)
```

b\. How many SRS's of size 4 are possible?

```{r}
N <- length(student) #population size
n <- 4 #sample size

num_srs <- choose(N, n)

num_srs
```

c\. List the possible SRS's. For each, find the sample mean. Using Equation (2.9), find $V(\bar y)$.

```{r}
#create a dataframe
data <- data.frame(student,score)

#sample for students
srs3 <- as.data.frame(combinations(n = N, r = n, v = student, repeats.allowed = FALSE))
srs3


```

Combined with the student score values, we get the following dataframe

```{r}
#corresponding sample for scores
test = combn(score, 4)
srs.scores <- as.data.frame(t(test))

# Set column names
colnames(srs.scores) <- paste0("Score_", 1:4)

#combine the two data
srs3 <- data.frame(srs3, srs.scores)

srs3
```

```{r}
#get the per sample mean
srs3$scoremeans <- apply(srs3[5:8], 1, mean)
srs3$scoremeans

```

```{r}
#calculate the overall sample mean
sample_mean <- mean(srs3$scoremeans)
cat('sample_mean:' , sample_mean)
```

Equation 2.9 : (variance of mean formula)

$$
V(\bar y) = (1 - \frac{n}{N}) \times \sigma^2
$$

implemented as follows

```{r}
variance = (1 - n/6) * var.score/n
cat('variance:', variance)
```

d\. Now let stratum 1 consist of students 1--3, and stratum 2 consist of students 4--6. How many stratified random samples of size 4 are possible in which 2 students are selected from each stratum?

```{r}
#add strata column to dataframe
strata <- c(rep(1, 3), rep(2, 3))

data$strata <- strata
data
```

Multiply the combinations

```{r}
total <- 3
n <- 2

comb1 <- choose(total, n)
comb2 <- choose(total, n)

srs4 <- comb1*comb2

srs4
```

e\. List the possible stratified random samples. Which of the samples from (c) cannot occur with the stratified design?

```{r}
data1 <- data %>%
  filter(data$strata == 1)

data1
```

```{r}
data2 <- data %>%
  filter(data$strata == 2)

data2
```

```{r}
#get samples of size 2 from both strata
vec1 <- data1$score
vec2 <- data2$score

vec1.srs <- as.data.frame(combinations(n = 3, r = 2, v = vec1, repeats.allowed = FALSE))
vec2.srs <- as.data.frame(combinations(n = 3, r = 2, v = vec2, repeats.allowed = FALSE))

vec1.srs <- vec1.srs %>%
  mutate(vec1 = paste(V1, V2, sep = ","))

vec2.srs <- vec2.srs %>%
  mutate(vec2 = paste(V1, V2, sep = ","))

sample_vec <- c(vec1.srs$vec1, vec2.srs$vec2)
sample_vec

samples <- as.data.frame(combinations(n = 6, r = 2, v = sample_vec, repeats.allowed = FALSE))
samples

#separate samples
df <- separate(samples, V1, into = c("Val1", "Val2"), sep = ",")
df <- separate(df, V2, into = c('Val3', 'Val4'), sep = ',')

#unique combinations
df <- df[c(-1, -2, -6, -13, -14, -15), ]
df 
```

You cannot have any of the samples from (c) which contain 3 units from one of the strata. This eliminates the first 3 samples, which contain {1, 2, 3} and the three samples containing students {4, 5, 6}.

f\. **Find** $\bar y_{str}$ **for each possible stratified random sample. Find** $V(\bar y_{str} )$**, and compare it to** $V (\bar y)$

$\bar y_{str}$ is found as follows:

```{r}
vec1 <- as.numeric(df$Val1)
vec2 <- as.numeric(df$Val2)
vec3 <- as.numeric(df$Val3)
vec4 <- as.numeric(df$Val4)

df <- data.frame(vec1, vec2, vec3, vec4)

df$ystr <- apply(df, 1, mean)
df$ystr
```

Variance of the mean is calculated as follows

$$
V(\bar y_{st}) = \frac{1}{N^2}\sum_{i = 1}^LN^2_i(1- \frac{n_i}{N_i})(\frac{s^2_i}{n_i})
$$

```{r}
#define the parameters of the formula
#variances
var1 = var(data1$score) #31
var2 = var(data2$score) #44.33

#Stratum values
N = 6
Ni = 3
ni = 2

#create formula
str1 <- (Ni^2)*(1-(ni/Ni))*(var1/ni)
str2 <- (Ni^2)*(1-(ni/Ni))*(var2/ni)
Vyst <- (1/N^2)*(sum(str1, str2))

cat('Variance of the means of the stratified samples:', Vyst, 'Variance of the unstratified sampe means:', variance)
```

The variance is smaller because the extreme samples from (c) are excluded by the stratified design. The variances $S^2_1 = 31$ (strata 1) and $S^2_2 = 44.33$ (strata 2) are much smaller than the population variance $S^2$

### Question 4:

**For Example 3.4, construct a data set with 3835 observations. Include three columns: column 1 is the stratum number (from 1 to 7), column 2 contains the response variable of gender (0 for males and 1 for females), and column 3 contains the sampling weight** $N_h/n_h$ **for each observation. Using columns 2 and 3 along with (3.10), calculate** $\hat p_{str}$ **. Is it possible to calculate SE(** $\hat p_{str}$ **) by using only columns 2 and 3, with no additional information? Explain**.

Step 1 is to create the data-frame from example 3.4.

```{r}
# Create data frame 
acls <- data.frame(
  stratum = c("Literature", "Classics", "Philosophy", "History", "Linguistics", "PoliSci", "Sociology"),
  Membership = c(9100, 1950, 5500, 10850, 2100, 5500, 9000),
  NoMailed = c(915, 633, 658, 855, 667, 833, 824),
  returns = c(636, 451, 481, 611, 493, 575, 588),
  percfem = c(38, 27, 18, 19, 36, 13, 26)
)
acls
```

Membership represents the population size per stratum, returns represents the samples per stratum, ans percfem represents the percentage of responses that are from women.

```{r}
# Calculate females, males, and sampwt
acls$females <- round(acls$returns * acls$percfem / 100)
acls$males <- acls$returns - acls$females

# calculate the sampling weight
acls$sampwt <- acls$Membership / acls$returns

#print
acls

```

```{r}
# Create aclslist data frame in R
aclslist <- data.frame()

# Populate aclslist data frame
for (i in seq(nrow(acls))) {
  aclslist <- rbind(aclslist, data.frame(
    stratum = rep(acls$stratum[i], acls$females[i] + acls$males[i]),
    femind = rep(c(rep(1, acls$females[i]), rep(0, acls$males[i])), each = 1),
    sampwt = rep(acls$sampwt[i], acls$females[i] + acls$males[i])
  ))
}

nrow(aclslist)
# Check whether the data set was created correctly
table(aclslist$stratum, aclslist$femind)
```

```{r}
# Perform survey means analysis
#library(survey)
design <- svydesign(data = aclslist, 
                    strata = ~stratum,
                    weights = ~sampwt, 
                    id = ~1)

result <- svymean(~femind, design)
result
```

**Why different answers**

### Question 5

The survey in Example 3.4 collected much other data on the subjects. Another of the survey's questions asked whether the respondent agreed with the following statement: "When I look at a new issue of my discipline's major journal, I rarely find an article that interests me." The results are as follows:

| Discipline        | Agree% |
|-------------------|--------|
| Literature        | 37     |
| Classics          | 23     |
| Philosophy        | 23     |
| History           | 29     |
| Liguistics        | 19     |
| Political Science | 43     |
| Sociology         | 41     |

a\. What is the sampled population in this survey?

> The sampled population consists of members of the organizations who would
>
> respond to the survey.

b\. Find an estimate of the percentage of persons in the sampled population that agree

with the statement, and give the standard error of your estimate?

> The question is asking for an estimate of population proportion, which uses this formula:
>
> $$
> \hat p_{str} = \sum^k_{h=1}\frac{N_h}{N}\hat p_h
> $$
>
> Using information from example 3.4:

```{r}
#define the parameters
#Popiulation parameter
N = 44000

#strata population parameters
N1 = 9100 #Literature
N2 = 1950 #classics
N3 = 5500 # philosophy
N4 = 10850 # history
N5 = 2100 # linguistics
N6 = 5500 # polysci
N7 = 9000 #sociology

#strata proportion parameters
p1 = 0.37 #Literature
p2 = 0.23 #Classics
p3 = 0.23 #Classics
p4 = 0.29 #History
p5 = 0.19 #Linguistics
p6 = 0.43 #Poliscy
p7 = 0.41 #Sociology

#run the formula per stratum
prop1 <- (N1/N)*p1
prop2 <- (N2/N)*p2
prop3 <- (N3/N)*p3
prop4 <- (N4/N)*p4
prop5 <- (N5/N)*p5
prop6 <- (N6/N)*p6
prop7 <- (N7/N)*p7

#sum of the formulas
pstr <- sum(prop1, prop2, prop3, prop4, prop5, prop6, prop7)

#print the result
cat('Estimate of Population Proportion: ', pstr)
```

For the standard error, we use the formula

$$
SE[\hat p_{str}] = \sqrt{\sum^k_{h=1}(1 - \frac{n_h}{N_h})(\frac{N_h}{N})^2(\frac{\hat p_h(1-\hat p_h))}{n_h - 1}}
$$

```{r}
#defien unspecified parameters
n1 = 636 #Literature
n2 = 451 #Classics
n3 = 481 #Philosophy
n4 = 611 #History
n5 = 493 #Linguistics
n6 = 575 #Poliscy
n7 = 588 #Sociology

#run formula per stratum
SE1 <- (1-(n1/N1))*((N1/N)^2)*((p1*(1-p1))/(n1-1))
SE2 <- (1-(n2/N2))*((N2/N)^2)*((p2*(1-p2))/(n2-1))
SE3 <- (1-(n3/N3))*((N3/N)^2)*((p3*(1-p3))/(n3-1))
SE4 <- (1-(n4/N4))*((N4/N)^2)*((p4*(1-p4))/(n4-1))
SE5 <- (1-(n5/N5))*((N5/N)^2)*((p5*(1-p5))/(n5-1))
SE6 <- (1-(n6/N6))*((N6/N)^2)*((p6*(1-p6))/(n6-1))
SE7 <- (1-(n7/N7))*((N7/N)^2)*((p7*(1-p7))/(n7-1))

#sum and square root the formula
SEstr <- sqrt(sum(SE1, SE2, SE3, SE4, SE5, SE6, SE7))

#print result
cat('Standard Error of Proportion Estimate:', SEstr)
```

### Question 6

Suppose that a city has 90,000 dwelling units, of which 35,000 are houses, 45,000 are apartments, and 10,000 are condominiums.

a\. You believe that the mean electricity usage is about twice as much for houses as for apartments or condominiums, and that the standard deviation is proportional to the mean so that S1 = 2S2 = 2S3 . How would you allocate a stratified sample of 900 observations if you wanted to estimate the mean electricity consumption for all households in the city?

> Using the concept of Neymann Allocation where
>
> $$
> n_h = \alpha N_hS_h
> $$

```{r}
#define the data
stratum <- c("Houses", "Apartments", "Condos")

#define dwelling units per strata
Nh <- c(35000, 45000, 10000) 

#Relative standard deviation in each stratum, as evidenced by the mean
Rh <- c(2,1,1)  

#NhRh for each stratum
NhRh<-Nh*Rh

#nh for each stratum
nh <- round(900*NhRh/sum(NhRh))

#create sums vector
Sum <- c('Sum', sum(Nh), sum(Rh), sum(NhRh), sum(nh))

#create a data frame
dwelling.df <- data.frame(Stratum=stratum,Nh=Nh,Rh=Rh,NhRh=NhRh,nh=nh)

#row bind the sums
dwelling.df <- rbind(dwelling.df, Sum)

#Print the data frame
dwelling.df
```

b\. Now suppose that you take a stratified random sample with proportional allocation and want to estimate the overall proportion of households in which energy conservation is practiced. If 45% of house dwellers, 25% of apartment dwellers, and 3% of condomium residents practice energy conservation, what is $p$ for the population? What gain would the stratified sample with proportional allocation offer over an SRS, that is, what is $\frac{V_{prop}(\hat p_{str} )}{V_{SRS}(\hat p_{SRS} )}$?

To calculate p we use the formula

$$
\hat p_{str} = \sum^k_{h=1}\frac{N_h}{N}\hat p_h
$$

```{r}
#define parameters
p <- c(0.45, 0.25, 0.03)
Nh <- c(35000, 45000, 10000) 
N <- 90000

#run formula
prop <- sum((Nh/N)*p)
cat('Proportion: ', prop)
```

> Suppose we take a sample size of 900.
>
> For proportional allocation, we divide each $N_h$ by:

```{r}
90000/900
```

Thus we get proportional allocation of

```{r}
Props <- Nh/100
df2 <- cbind(stratum, Props)
df2
```

Following the formula

$$
V_{str}[\hat p_{str}] = \sum_{i=1}^k(\frac{n_i}{N_i})^2\frac{p(1-p)}{ni}
$$

```{r}
#define parameters
Ni <- c(900, 900, 900)
ni <- c(350, 450, 100)
p <- c(0.45, 0.25, 0.03)
pneg <- c(0.55, 0.75, 0.97)

#run formula
vpstr <- ((ni/Ni)^2)*((p*pneg)/ni)

#sum result
vpstr.sum <- sum(vpstr)

#print result
cat('variance of Proportion Estimate: ', vpstr.sum)
```

we can get variance of proportion for an srs using the formula

$$
V_{SRS}[\hat P_{SRS}] = \frac{p(1-p)}{ni}
$$

```{r}
ni <- 900
#compute formula
vsrs <- sum((prop*(1-prop))/ni)

cat("vsrs:", vsrs)
```

Compare vpstr.sum and vsrs

```{r}
vpstr.sum/vsrs
```

We only need 0.9144n observations, taken in a stratified sample with proportional

allocation, to achieve the same variance as in an SRS with n observations

### Question 7

In Exercise 6 of Chapter 2, data on numbers of publications were given for an SRS of 50 faculty members. Not all departments were represented, however, in the SRS. The SRS contained several faculty members from psychology and from chemistry, but none from foreign languages. The following data are from a stratified sample of faculty, using the areas biological sciences, physical sciences, social sciences, and humanities as the strata.

| Stratum             | Number of Faculty Members in Stratum | Numebr of Faculty Members in sample |
|---------------------|--------------------------------------|-------------------------------------|
| Biological sciences | 102                                  | 7                                   |
| Physical sciences   | 310                                  | 19                                  |
| Social sciences     | 217                                  | 13                                  |
| Humanities          | 178                                  | 11                                  |
| **Total**           | 807                                  | 50                                  |

The frequency table for number of publications in the strata is given below

| Number of Refereed Publications | Biological | Physical | Social | Humanities |
|---------------------------------|------------|----------|--------|------------|
| 0                               | 1          | 10       | 9      | 8          |
| 1                               | 2          | 2        | 0      | 2          |
| 2                               | 0          | 0        | 1      | 0          |
| 3                               | 1          | 1        | 0      | 1          |
| 4                               | 0          | 2        | 2      | 0          |
| 5                               | 2          | 1        | 0      | 0          |
| 6                               | 0          | 1        | 1      | 0          |
| 7                               | 1          | 0        | 0      | 0          |
| 8                               | 0          | 2        | 0      | 0          |

a\. Estimate the total number of refereed publications by faculty members in the college, and give the standard error.

> find $\hat t_{str}$
>
> formula:
>
> $$
> T = N(\bar y_{st}) = [N_1\bar y_1 + N_2\bar y_2 +...+ N_L\bar y_L] = \sum_{i = 1}^LN_i\bar y_i
> $$

```{r}
#calculate strata means
refereed <- c(0:8)
Biological <- c(1,2,0,1,0,2,0,1,0)
Physical <- c(10,2,0,1,2,1,1,0,2)
Social <- c(9,0,1,0,2,0,1,0,0)
Humanities <- c(8,2,0,1,0,0,0,0,0)

meanb <- sum(Biological)/9
meanb
```

```{r}
#define parameters
Stratum <- c('Biological', 'Physical', 'Social', 'Humanities')
Ni <- c(102, 310, 217, 178)

```

b\. How does your result from (a) compare with the result from the SRS in Exercise 6 of Chapter 2?

c\. Estimate the proportion of faculty with no refereed publications, and give the standard error.

d\. Did stratification increase precision in this example? Explain why you think it did or did not.

### Question 8

A public opinion researcher has a budget of \$20,000 for taking a survey. She knows that 90% of all households have telephones. Telephone interviews cost \$10 per household; in-person interviews cost \$30 each if all interviews are conducted in person, and \$40 each if only nonphone households are interviewed in person (because there will be extra travel costs). Assume that the variances in the phone and non-phone groups are similar, and that the fixed costs are c0 = \$5000. How many households should be interviewed in each group if:

a\. all households are interviewed in person

> Because the budget for interviews is \$15,000, a total of 15,000/30 = 500 in-person interviews can be taken. The variances in the phone and nonphone strata are assumed similar, so proportional allocation is optimal: 450 phone households and 50 nonphone households would be selected for interview.

b\. households with a phone are contacted by telephone and households without a phone are contacted in person.

> The variances in the two strata are assumed equal, so optimal allocation gives

$$
n_h \alpha N_h/\sqrt{c_h}
$$

```{r}
stratum <- c('Phone', 'Nonphone')
ch <- c(10, 40)
NhN <- c(0.9, 0.1)

```

### Question 9

The data file agstrat.dat also contains information on other variables. For each of the following quantities, plot the data, and estimate the population mean for that variable along with its standard error and a 95% CI. Compare your answers with those from the SRS in Exercise 15 of Chapter 2.

#### **a) Number of acres devoted to farms, 1987 (5 marks)**

First I imported the data set, and viewed the column names.

```{r}
#impot the data #library(SDAResources)
data(agstrat)

#view column names
names(agstrat)
```

The number of acres devoted to farms, 1987 corresponds to the variable `acres87` .

##### Part 1: Plot the Data

I plotted a **histogram** and a **Boxplot** of the data to explore different aspects of it.

**Histogram**

I used the `geom_histogram()` function from the `ggplot2` library to plot the histogram below:

```{r}
#plot histogram #library(tidyverse)
ggplot(agstrat, aes(x = acres87 / 10^6)) +
  geom_histogram(fill = "purple", color = "black", alpha = 0.7) +
  labs(x = "Millions of Acres", y = "Frequency") +
  ggtitle("Histogram of Farm Acres in 1987")
```

The histogram is **right skewed**, such that the mode of the distribution is less than the mean. This implies that majority of farmers planted less acres than the mean amount of acres planted in 1987.

**Boxplot**

I used the `geom_boxplot()` function from the `ggplot2` package to plot the following boxplot, in order to explore the acreage planted per region:

```{r}
ggplot(agstrat, aes(x = region, y = acres87 / 10^6, fill = region)) +
  geom_boxplot() +
  labs(x = "Region", y = "Millions of Acres") +
  ggtitle("Boxplot of Farm Acres per Region in 1987")
```

The Boxplot shows that the **State W** had the **highest mean** of land dedicated to farms in 1987, as well as the **largest interquartile range**.

##### Part 2: Estimation of Population Mean, Standard Error and Confidence Interval

To calculate the stated statistics, I created a Survey Design.

```{r}
# create a variable containing population stratum sizes #library(survey)
popsize_recode <- c('NC' = 1054, 'NE' = 220, 'S' = 1382, 'W' = 422)

#substitute population sizes for strata names
agstrat$popsize <- popsize_recode[agstrat$region]
table(agstrat$popsize) #check the new variable
```

I then input the design information.

```{r}
dstr <- svydesign(id = ~1, strata = ~region, weights = ~strwt, fpc = ~popsize, data = agstrat)

dstr
```

**Mean and Standard Error** (Using survey information)

```{r}
#calculate mean, SE and confidence interval
smean <- svymean(~acres87, dstr)
smean
```

**Confidence Interval**

```{r}
confint(smean, level=.95, df=degf(dstr)) 
```

The computed statistics are

$$
Mean = 298547
$$

$$
SE = 16293
$$

$$
CI = [266482.4, 330611.8]
$$

#### **b) Number of farms, 1992( 5marks)**

The number of farms, 1992 corresponds to the variable `farms92` .

##### Part 1: Plot the data

**Histogram**

```{r}
#plot histogram #library(tidyverse)
ggplot(agstrat, aes(x = farms92 )) +
  geom_histogram(fill = "red", color = "black", alpha = 0.7) +
  labs(x = "Number of farms", y = "Frequency") +
  ggtitle("Histogram of Number of Farms, 1992")
```

The above histogram is **right skewed** suggesting that the mode of the distribution is less than the mean and the median. This implies that the number of farms in 1992 tended to be below the mean of the distribution, on the lower end.

**Boxplot**

```{r}
ggplot(agstrat, aes(x = region, y = farms92, fill = region)) +
  geom_boxplot() +
  labs(x = "Region", y = "Number of Farms") +
  ggtitle("Boxplot of Number of farms in 1992")
```

The **NC** region has the highest mean of number of farms in 1992, while the **S** region exhibits the most variance.

##### Part 2: Estimation of Population Mean, Standard Error and Confidence Interval

I computed this using the survey design I created in part (a)

**Mean and Standard Error**

```{r}
#calculate mean, SE and confidence interval
smean1 <- svymean(~farms92, dstr)
smean1
```

**Confidence Interval**

```{r}
confint(smean1, level=.95, df=degf(dstr))
```

The computed statistics are as follows:

$$
Mean = 637.16 \\
SE = 24.277 \\
CI = [589.3853, 684.9422]
$$

#### **c) Number of farms with 1000 acres or more, 1992 (5 marks)**

##### Part 1: Plot the data

The number of farms with 1000 acres or more, 1992 corresponds with the `largef92` variable.

**Histogram**

```{r}
#plot histogram #library(tidyverse)
ggplot(agstrat, aes(x = largef92)) +
  geom_histogram(fill = "cyan", color = "black", alpha = 0.7) +
  labs(x = "Number of Large Farms (>= 1000 Acres)", y = "Frequency") +
  ggtitle("Histogram of Large Farms in 1992")
```

The histogram is **right skewed**, thus the mod of the distribution is less than the median and mean. Thus, in 1992 there tended to be less large farms as compared to the mean number that existed.

**Boxplot**

```{r}
ggplot(agstrat, aes(x = region, y = largef92, fill = region)) +
  geom_boxplot() +
  labs(x = "Region", y = "Number of Large Farms (>= 1000 Acres") +
  ggtitle("Boxplot of Number of Large Farms in 1992")
```

The **W** region has the highest mean of number of large farms in 1992, as well as shows the highest amount of variation, and the largest interquartile range.

##### Part 2: Estimation of Population Mean, Standard Error and Confidence Interval

I computed this using the survey design I created in part (a)

**Mean and Standard Error**

```{r}
#calculate mean, SE and confidence interval
smean3 <- svymean(~largef92, dstr)
smean3
```

**Confidence Interval**

```{r}
confint(smean3, level=.95, df=degf(dstr))
```

The computed statistics are:

$$
Mean = 56.698\\
SE = 3.5577\\
CI = [49.696, 63.700]
$$

#### **d) Number of farms with 9 acres or fewer, 1992 (5 marks)**

The number of farms with 9 acres or fewer, 1992, corresponds with the variable `smallf92` .

##### Part 1: Plot the Data

**Histogram**

```{r}
#plot histogram #library(tidyverse)
ggplot(agstrat, aes(x = smallf92)) +
  geom_histogram(fill = "orange", color = "black", alpha = 0.7) +
  labs(x = "Number of Small Farms (<= 9 Acres)", y = "Frequency") +
  ggtitle("Histogram of Number of Small Farms in 1992")
```

The histogram is very **right skewed**, suggesting the mode of the distribution is smaller than the mean and the median. This suggests that the number of small farms in 1992 tended to be less than the mean value for the year.

**Boxplot**

```{r}
ggplot(agstrat, aes(x = region, y = smallf92, fill = region)) +
  geom_boxplot() +
  labs(x = "Region", y = "Number of Small Farms (<= 9 Acres)") +
  ggtitle("Boxplot of Number of Small Farms in 1992")
```

There is little difference in the mean of number of small farms in 1992, but the **W** region has the highest interquartile range, and the largest variation among the regions.

##### Part 2: Estimation of Population Mean, Standard Error and Confidence Interval

I computed this using the survey design I created in part (a)

**Mean and Standard Error**

```{r}
#calculate mean, SE and confidence interval
smean4 <- svymean(~smallf92, dstr)
smean4
```

**Confidence Interval**

```{r}
confint(smean4, level=.95, df=degf(dstr))
```

The computed statistics are as follows:

$$
Mean = 56.863\\
SE = 7.201\\
CI = [42.69, 71.04]
$$

### Question 10

Hard shell clams may be sampled by using a dredge. Clams do not tend to be uniformly distributed in a body of water, however, as some areas provide better habitat than others. Thus, taking a simple random sample is likely to result in a large estimated variance for the number of clams in an area. Russell (1972) used stratified random sampling to estimate the total number of bushels of hard shell clams (Mercenariamercenaria) in Narragansett Bay, Rhode Island. The area of interest was dividedinto four strata based on preliminary surveys that identified areas in which clams were abundant. Then nh dredge tows were made in stratum h, for h = 1, 2, 3, 4. The acreage for each stratum was known, and Russell calculated that the area fished during a standard dredge tow was 0.039 acres, so that we may use Nh = 25.6 × Areah.

a\. Here are the results from the survey taken before the commercial season. Estimate the total number of bushels of clams in the area, and give the standard error of your estimate.

| Stratum | Area (Acres) | Number of Tows made | Avg number of Bushels per tow | Sample variance for stratum |
|---------|--------------|---------------------|-------------------------------|-----------------------------|
| 1       | 222.81       | 4                   | 0.44                          | 0.068                       |
| 2       | 49.61        | 6                   | 1.17                          | 0.042                       |
| 3       | 50.25        | 4                   | 3.92                          | 2.146                       |
| 4       | 197.91       | 5                   | 1.80                          | 0.794                       |

b\. Another survey was performed at the end of the commercial season. In this survey,

strata 1, 2, and 3 were collapsed into a single stratum, called stratum 1 below.

Estimate the total number of bushels of clams (with standard error) at the end of

the season.

| Stratum | Area (Acres) | Number of Tows Made | Average Number of Bushes Per tow | Sample Variance Per stratum |
|---------|--------------|---------------------|----------------------------------|-----------------------------|
| 1       | 322.67       | 8                   | 0.63                             | 0.083                       |
| 4       | 197.81       | 5                   | 0.40                             | 0.046                       |

# Sample Surveys Formulas

## SIMPLE RANDOM SAMPLING

### Sample size

$$
n
$$

### Population Size

$$
N
$$

### Sample mean formula: (unbiased estimator of population mean)

$$\bar y = \frac{\sum_{i=1}^ny_i}{n}=\frac{y_i}{n}$$

```{r}
#mean()
```

### Unbiased estimator of the population total

$$
T = N\bar y
$$

### Population mean

$$
μ=  \frac{T}{N} 
 $$

### If unbiased the population mean and sample mean should be equal.

Central limit theorem: if you create a sufficiently large sampling distribution and get the mean of the sample means, you should get the population mean.

$$ 
E(\bar y)=μ
$$

### Sample Standard Deviation

$$
s = \sqrt{\frac{1}{n-1}\sum_{i = 1}^n(y - \bar y_i)^2}
$$

### Finite Population Correction (FPC)

Used when calculating Standard error and Confidence Intervals for finite populations.

$$
FPC = 1 - \frac{n}{N}
$$

FPC is usually used if the ratio $\frac{n}{N} \geq 5\%$

### Standard Error of the sample mean ( $\sigma_{\bar y}$ )

This is a measure of confidence in our mean estimate. The lower the standard error the higher the confidence

#### Infinite Population (with replacement)

$$
SE(\bar y) = \frac{s}{\sqrt{n}}
$$

#### Finite population (without replacement)

$$
SE(\bar y) = \frac{s}{\sqrt{n}}\sqrt{\frac{N-n}{N-1}}
$$

### Standard Error of the Sample Proportion ( $\sigma _{p}$ ) - stratified sampling

This is a measure of confidence in our proportion estimate. The lower the standard error the higher the confidence.

#### Infinite Population

$$
SE = \sqrt{\frac{p(1-p)}{n}}
$$

#### Finite Population

$$
SE = \sqrt{\frac{p(1-p)}{n}}\sqrt\frac{N-n}{N-1}
$$

### Confidence Interval

#### Mean Estimate

With known variance - z distribution

$$
CI = \bar y \pm Z \times SE_{\bar y}
$$

```{r}

```

With unknown variance - t distribution

$$
CI = \bar y \pm t \times SE_{\bar y}
$$

#### Proportion Estimate

$$
CI = \hat p \pm Z \times SE_{\hat p}
$$

### Sample variance

$$
s^2  =  \frac{1}{n - 1} \sum_{i=1}^n(y_i-\bar y)^2
 $$

### Estimated variance of $\bar y$

Measure of how the sample mean is expected to vary from sample to sample.

$$
V(\bar y)=(1-\frac{n}{N})\frac{s^2}{n} 
$$

### Bound on the error of estimation - standard error of mean

$$
2\sqrt{V(\bar y)} 
$$

### Estimated Variance of Proportion

$$
V_{SRS}[\hat P_{SRS}] = \frac{p(1-p)}{ni}
$$

### Estimated variance of T

$$
V(T)=V(N\bar y) = N^2 (1 - \frac{n}{N})\frac{s^2}{n}
$$

### Bound on the error of estimation - standard error of variance

$$
2\sqrt{V(N\bar y)} = 2\sqrt{
N^2 (1 - \frac{n}{N})\frac{s^2}{n}
}
$$

## STRATIFIED SAMPLING

### Stratum Population Size

$$
N_i
$$

### Stratum Sample size

$$
n_i
$$

### Estimator of the population mean (μ):

$$
y_{st} = \frac{1}{N}[N_1\bar y_1 + N_2\bar y_2 +...+ N_L\bar y_L] = \frac{1}{N}\sum_{i = 1}^LN_i\bar y_i
$$

> where
>
> $N_i$ is the population size per stratum
>
> $\bar y_i$ is the sample mean per stratum

### Estimator of Population proportion (Stratified)

$$
\hat p_{str} = \sum^k_{h=1}\frac{N_h}{N}\hat p_h
$$

#### Standard Error for PP:

$$
SE[\hat p_{str}] = \sqrt{\sum^k_{h=1}(1 - \frac{n_h}{N_h})(\frac{N_h}{N})^2(\frac{\hat p_h(1-\hat p_h))}{n_h - 1}}
$$

#### Estimated Variance of PP

$$
V_{str}[\hat p_{str}] = \sum_{i=1}^k(\frac{n_i}{N_i})^2\frac{p(1-p)}{ni}
$$

### Estimated variance of $\bar y_{st}$

$$
V(\bar y_{st}) = \frac{1}{N^2}\sum_{i = 1}^LN^2i(1- \frac{n_i}{N_i})(\frac{s^2_i}{n_i})
$$

### Estimator of the population total T:

$$
T = N(\bar y_{st}) = [N_1\bar y_1 + N_2\bar y_2 +...+ N_L\bar y_L] = \sum_{i = 1}^LN_i\bar y_i
$$

### Estimated Variance of T

$$
V(T) = V(N \bar y_{st}) = N^2V(\bar y_{st}) = \sum_{i = 1}^LN^2i(1-\frac{n_i}{N_i})(\frac{s^2_i}{n_i})
$$

### Proportional allocation

$$ 
n_i=n (\frac{N_i}{N}) 
$$

## SYSTEMATIC SAMPLING

### Estimator of the population mean μ

$$\mu = \bar y_{sy} = \frac{\sum_{i = 1}^ny_i}{n} = \frac{y_i}{n} $$

### Estimated variance of $\bar y_{sy}$

$$
V(\bar y_{sy}) = (1 - \frac{n}{N})\frac{s^2}{n}
$$

### Estimator of the population total $\tau$:

$$
T=N\bar y_{sy} 
 $$

### Estimated variance of T:

$$
V(N\bar y_{sy})= N^2V(\bar y_{sy}) = N^2(1- \frac{n}{N})\frac{s^2}{n}
$$

### Neymann Allocation

$$
n_h = \alpha N_hS_h
$$

# Code Concepts

## Complex Survey Design

**Sampling weights:** Number of people in a population that a sampled unit represents.

They are as a result of using a complex survey design in sampling.

**Steps**

```{r}
#library(survey)
##create survey design - simple random sampling
#srs_design <- svydesign(data = yourdata, 
                        #weights = ~wts,
                        #fpc = ~Populationsize, 
                        #id = ~1) - this is the sampling stage

#str_design <- svydesign(data = yourdata, 
                        #strata = ~stratumVariable, 
                        #weights = ~wts, 
                        #fpc = ~popsize, 
                        #id = ~1)

##id is automatically 1 for both srs and stratified
```

With this, you can compute the mean, confidence interval and standard error as follows

```{r}
##mean
#smean <- svymean(~variable, svy_design)
#confint(smean, level=.95, df=degf(svy_design)) 

##svy_design represents whichever design you create
```

# Definitions

## Census

A survey in which the entire population is measured

## Coverage

The percentage of the population of interest that is included in the sampling frame

## Non response

Failure of some units in the sample to provide responses to the survey

## **Observation unit**

An object on which a measurement is taken. This is the basic unit of observation, sometimes called an element. In studying human populations, observation units are often individuals.

## Target Population

The complete collection of observations we want to study

## Sample

A subset of a Population

## Sampled Population

The collection of all possible observation units that might have been chosen in a sample; the population from which the sample was taken.

## Sampling Unit

A unit that can be selected for a sample.

## Sampling Frame

A list, map, or other specification of sampling units in the population from which a sample may be selected.

## Selection Bias

occurs when some part of the target population is not in the sampled population, or, more generally, when some population units are sampled at a different rate than intended by the investigator. Bias that occurs because the actual probabilities with which units are sampled differ from the selection probabilities specified by the investigator.

## Measurement Error

When a response in the survey differs from the true value, measurement error has occurred. Measurement bias occurs when the response has a tendency to differ from the true value in one direction. It is The difference between the response coded and the true value of the characteristic being studied for a respondent

## Sampling error

the error that results from taking one sample instead of examining the whole population.

## Non-Sampling error

which are any errors that cannot be attributed to the sample-to-sample variability, like selection bias and measurement error.

## Cluster sample:

A probability sample in which each population unit belongs to a group, or cluster, and the clusters are sampled according to the sampling design.

## Confidence interval (CI):

An interval estimate for a population quantity, for which the probability that the random interval contains the true value of the population quantity is known.

## Design-based inference:

Inference for finite population characteristics based on the survey design, also called randomization inference.

## Finite population correction (fpc):

A correction factor which, when multipled by the with-replacement variance, gives the without-replacement variance. For an SRS of size n from a population of size N, the fpc is 1 − n/N.

## Inclusion probability:

πi = probability that unit i is included in the sample.

## Margin of error:

Half of the width of a 95% CI.

## Model-based inference:

Inference for finite population characteristics based on a model for the population, also called prediction inference.

## Probability sampling:

Method of sampling in which every subset of the population has a known probability of being included in the sample.

## Sampling distribution:

The probability distribution of a statistic generated by the sampling design.

## Sampling weight:

Reciprocal of the inclusion probability; wi = 1/πi.

## Self-weighting sample:

A sample in which all probabilities of inclusion πi are equal, so that all sampling weights w i are the same.

## Simple random sample with replacement (SRSWR):

A probability sample in which the first unit is selected from the population with probability 1/N; then the unit is replaced and the second unit is selected from the set of N units with probability 1/N, and so on until n units are selected.

## Simple random sample without replacement (SRS):

An SRS of size n is a probability sample in which any possible subset of n units from the population has the same probability (= n!(N − n)!/N!) of being the sample selected.

## Standard error (SE):

The square root of the estimated variance of a statistic.

## Stratified sample:

A probability sample in which population units are partitioned into strata, and then a probability sample of units is taken from each stratum.

## Systematic sample:

A probability sample in which every kth unit in the population is selected to be in the sample, starting with a randomly chosen value R. Systematic sampling is a special case of cluster sampling.

## Disproportional allocation:

Allocation of sampling units to strata so that the sampling fractions n h/N h are unequal.

## Optimal allocation:

Allocation of sampling units to strata so that the variance of the estimator is minimized for a given total cost.

## Proportional allocation:

Allocation of sampling units to strata so that n h/N h = n/N for each stratum. Proportional allocation results in a self-weighting sample.

## Quota sampling:

A nonprobability sampling method which many persons confuse with stratified sampling. In quota sampling, quota classes are formed that serve the role of strata, but the survey taker uses a nonprobability sampling method such as convenience sampling to reach the desired sample size in each quota class.

## Stratified random sampling:

Probability sampling method in which population units are partitioned into strata, and then an SRS is taken from each stratum.

## Stratum:

One of the sub-populations or classes that make up the entire population. Every unit in the population is in exactly one stratum
